<!DOCTYPE html>
<html>
	<head>
		<base href="../../" />
		<meta charset="utf-8" />

		<script src="_ext/d3.v3.min.js"></script>
		<script src="_ext/jquery-1.10.2.min.js"></script>
		<script src="_ext/sha1.js"></script>
		<script src="js/animation.js"></script>
		<script src="js/simulation.js"></script>

		<style>
html, body {
	width: 100%;
	height: 100%;
	margin: 0px;
	padding: 0px;
}
#frame {
	width: 90%;
	height: 90%;
	margin: auto;
}

svg {
	border: 1px solid black;
}
		</style>
	</head>

	<body>
		<div id="frame"></div>
		<script>
$(document).ready(function() {
	var svg = d3.select('#frame').append('svg')
		.attr('width', 800)
		.attr('height', 600);

	var obj = new anim.Object(svg, 'image/test/flower.jpg', { x: 200, y: 200 });
	var ds = new sim.DistributedSystem(svg);

	var nbr = 6;
	for (var i = 0; i < nbr; i++) {
		ds.addNode(new sim.Node({
			name: 'n' + i,
			image: 'image/neufbox.png'
		}));
	}

	for (var i = 0; i < nbr; i++) {
		for (var j = 1; j <= nbr; j = j * 2) {
			var j2 = (i + j) % nbr;
			ds.addLink('n' + i, 'n' + j2);
		}
	}

	ds.transform('translate(500, 350) scale(0.4)');

	ds.call(obj);
	obj.show();
	obj.split(3, 5);
	obj.crypt();
	obj.minimize();

	obj.call(ds);
	ds.transform('translate(0, 0) scale(1)');

	console.log(obj.blocks);
	for (var i = 0; i < obj.blocks.length; i++) {
		ds.call(obj);
		obj.sendBlock(obj.blocks[i].name, { x: 350 * 2 , y: 20 * 2 });

		obj.call(ds);
		ds.addObject('n3', obj.blocks[i].name, 'image/test/crypted.jpg');

		ds.call(obj);
		obj.remove(obj.blocks[i].name);

		obj.call(ds);
		ds.store(obj.blocks[i].name);
	}

	ds.start();
});
		</script>
	</body>
</html>