<!DOCTYPE html>
<html>
	<head>
		<base href="../../" />
		<meta charset="utf-8" />


		<script type="text/javascript" src="_ext/d3.v3.min.js"></script>
		<script type="text/javascript" src="_ext/crossfilter.min.js"></script>
		<script type="text/javascript" src="_ext/dc.min.js"></script>

		<link rel="stylesheet" href="_ext/dc.css" />
	</head>

	<body>
		<div id="chart-line-hitsperday"></div>
		<script>
var data = [];

var ndx = crossfilter(data);

var parseDate = d3.time.format("%m/%d/%Y").parse;
data.forEach(function(d) {
	d.date = parseDate(d.date);
	d.total= d.http_404+d.http_200+d.http_302;
});
print_filter("data");

var dateDim = ndx.dimension(function(d) {return d.date;});
var hits = dateDim.group().reduceSum(dc.pluck('total'));
print_filter("hits");
console.log(hits);

var minDate = dateDim.bottom(1)[0].date;
var maxDate = dateDim.top(1)[0].date;

var hitslineChart = dc.lineChart("#chart-line-hitsperday");
hitslineChart
	.width(500).height(200)
	.dimension(dateDim)
	.group(hits)
	.x(d3.time.scale().domain([minDate,maxDate]))
	//.brushOn(false);
dc.renderAll();


function print_filter(filter){
	var f=eval(filter);
	if (typeof(f.length) != "undefined") {}else{}
	if (typeof(f.top) != "undefined") {f=f.top(Infinity);}else{}
	if (typeof(f.dimension) != "undefined")
	{f=f.dimension(function(d) { return "";}).top(Infinity);}else{}
	console.log(filter+"("+f.length+") = "+JSON.stringify
	(f).replace("[","[\n\t").replace(/}\,/g,"},\n\t").replace("]","\n]"));
}
		</script>
	</body>
</html>